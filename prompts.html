<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- ✅ AUTH GUARD (واحد فقط) -->
  <script>
    (function () {
      const AUTH_KEY = "HA_AUTH_OK";
      const authed = sessionStorage.getItem(AUTH_KEY) === "1";
      if (!authed) {
        const next = encodeURIComponent(location.pathname.split("/").pop() || "index.html");
        location.replace("./login.html?next=" + next);
      }
    })();
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>HA - Prompts</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet">

<style>
:root{
  --bg-dark:#0b1016;
  --bg-card:#121722;
  --accent-orange:#ff9d2f;
  --accent-teal:#14e0c3;
  --grad-orange: rgba(255,140,0,0.18);
  --grad-teal: rgba(0,180,160,0.100);
  --text:#ffffff;
  --muted:#bfc7d6;
  --radius:16px;
  --shadow:0 18px 55px rgba(0,0,0,0.35);
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}
html{scroll-behavior:smooth;}
body{
  background:
    radial-gradient(circle at 70% 20%, var(--grad-orange), transparent 44%),
    radial-gradient(circle at 20% 55%, var(--grad-teal), transparent 44%),
    var(--bg-dark);
  color:var(--text);
  overflow-x:hidden;
}
a{color:inherit;text-decoration:none;}

nav{
  position:sticky; top:0; z-index:999;
  padding:14px 5%;
  display:flex; align-items:center; justify-content:space-between; gap:14px;
  background:rgba(10,15,25,0.68);
  backdrop-filter: blur(14px);
  border-bottom:1px solid rgba(255,255,255,0.06);
}

.brand{display:flex; align-items:center; gap:12px; min-width:240px;}
.brandLogo{
  width:38px;height:38px;border-radius:12px;object-fit:cover;
  box-shadow:0 12px 30px rgba(0,0,0,0.35);
}
.brandText .title{font-weight:900;font-size:16px;line-height:1.2;}
.brandText .sub{font-size:12px;color:var(--muted);opacity:.92;}

.topBtn{
  background:var(--accent-teal);
  color:#001018;
  padding:10px 16px;
  border-radius:14px;
  font-weight:900;
  transition:.25s;
  white-space:nowrap;
}
.topBtn:hover{transform:translateY(-1px); filter:brightness(1.05);}

.container{padding:26px 8% 80px;}
@media(max-width:980px){ .container{padding:22px 6% 70px;} }

.head{
  display:flex; align-items:flex-end; justify-content:space-between;
  gap:16px; margin:22px 0 14px;
}
.head h1{font-size:34px;font-weight:900;line-height:1.2;}
.head p{color:var(--muted);line-height:1.8;max-width:700px;}

.searchRow{
  display:flex; gap:10px; flex-wrap:wrap;
  margin:14px 0 18px;
}
.search{
  flex:1 1 260px;
  background:rgba(0,0,0,0.22);
  border:1px solid rgba(255,255,255,0.10);
  color:#fff;
  border-radius:14px;
  padding:12px 14px;
  outline:none;
  font-weight:700;
}
.filter{
  flex:0 0 auto;
  background:rgba(0,0,0,0.22);
  border:1px solid rgba(255,255,255,0.10);
  color:#fff;
  border-radius:14px;
  padding:12px 14px;
  outline:none;
  font-weight:900;
}

.togglesWrap{display:flex;flex-direction:column;gap:12px;}

.tg{
  background:rgba(18,23,34,0.86);
  border:1px solid rgba(255,255,255,0.06);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}

.tg > summary{
  list-style:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  padding:14px 16px;
  user-select:none;
}
.tg > summary::-webkit-details-marker{display:none;}

.tgTitle{display:flex;align-items:center;gap:12px;min-width:0;}
.tgBadge{
  font-weight:900;font-size:12px;padding:6px 10px;border-radius:999px;
  color:var(--accent-teal);
  background:rgba(39,211,177,0.10);
  border:1px solid rgba(39,211,177,0.25);
  white-space:nowrap;
}
.tgText{
  font-weight:900;font-size:16px;color:#fff;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}

.tgArrow{
  width:42px;height:42px;border-radius:14px;display:grid;place-items:center;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(0,0,0,0.22);
  flex:0 0 auto;
  transition:.25s;
}
.tg[open] .tgArrow{transform:rotate(180deg);}

.tgBody{padding:0 16px 16px;border-top:1px solid rgba(255,255,255,0.06);}
.tgGrid{display:grid;grid-template-columns:1fr 240px;gap:14px;padding-top:14px;}
@media(max-width:980px){ .tgGrid{grid-template-columns:1fr;} }

.tgPrompt{
  background:rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:14px;
  padding:12px;
  color:var(--muted);
  line-height:1.9;
  font-weight:600;
  font-size:14px;
  white-space:pre-wrap;
}

.tgImg{
  width:100%;
  aspect-ratio: 4 / 3;
  border-radius:14px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,0.08);
  background:linear-gradient(135deg, rgba(39,211,177,0.08), rgba(255,157,47,0.06));
}
.tgImg img{width:100%;height:100%;object-fit:cover;display:block;}

.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
.btnSmall{
  padding:10px 14px;border-radius:14px;font-weight:900;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(0,0,0,0.22);
  color:#fff;
  cursor:pointer;
  transition:.25s;
}
.btnSmall:hover{transform:translateY(-1px);}
.smallOrange{background:var(--accent-orange); color:#1a0f00; border-color:transparent;}
.smallTeal{background:rgba(39,211,177,0.10); color:var(--accent-teal); border-color:rgba(39,211,177,0.45);}

/* ✅ Divider كل 15 */
.divider{
  margin:18px 0 6px;
  padding:12px 14px;
  border-radius:16px;
  background:rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.dividerTitle{font-weight:900;font-size:16px;}
.dividerHint{color:var(--muted);font-size:12px;}

.toast{
  position:fixed; bottom:18px; right:18px; z-index:9999;
  background:rgba(18,23,34,0.92);
  border:1px solid rgba(255,255,255,0.10);
  border-radius:14px;
  padding:12px 14px;
  box-shadow:0 18px 55px rgba(0,0,0,0.45);
  color:#fff;
  display:none;
  font-weight:900;
}
.toast.show{display:block;}

/* ✅ MOBILE NAV CENTER FIX */
@media (max-width: 768px){
  nav{
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    gap: 12px;
    padding: 14px 16px;
  }

  .brand{
    min-width: auto;
    width: 100%;
    justify-content: center;
    text-align: center;
  }

  .brandText{ text-align: center; }

  nav .actions{
    width: 100%;
    margin: 0 !important;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .topBtn{
    width: min(320px, 92%);
    text-align: center;
    display: inline-flex;
    justify-content: center;
    align-items: center;
  }
}
</style>
</head>

<body>

<nav>
  <div class="brand">
    <img class="brandLogo" src="assets/hero/hero.png" alt="logo" loading="eager" decoding="async">
    <div class="brandText">
      <div class="title">HA - Visual School</div>
      <div class="sub">Prompts Library</div>
    </div>
  </div>

  <div class="actions" style="display:flex;gap:10px;align-items:center;">
    <a class="topBtn" href="./prompt-editor.html">محرّر البرومبت</a>
    <a class="topBtn" href="./index.html">رجوع للرئيسية</a>
  </div>
</nav>

<div class="container">
  <div class="head">
    <div>
      <h1>مكتبة البرومبتات</h1>
      <p>اختار أي توجل واضغط <b>استخدم في المحرّر</b> علشان يتنقل تلقائيًا لمكانه الصحيح داخل الـ Prompt Editor.</p>
    </div>
  </div>

  <div class="searchRow">
    <input id="q" class="search" placeholder="ابحث بالعنوان أو بالكلمة..." />
    <select id="tag" class="filter">
      <option value="all">كل الأقسام</option>
    </select>
  </div>

  <div class="togglesWrap" id="wrap"></div>
</div>

<div class="toast" id="toast">تم النسخ ✅</div>

<script>
/* =========================
   ✅ CONFIG
========================= */
const EDITOR_PAGE = "./prompt-editor.html";

/* =========================
   ✅ DATA
========================= */
const DATA = [
  { tag:"AE", field:"style", title:"Bold Arabic cinematic", prompt:"Heavy 3D Arabic lettering, thick geometric strokes, metallic gold with rough embossed texture, deep extrusion with red inner sides, sharp bevels, dramatic studio lighting, luxury cinematic typography", img:"assets/thumbs/thumb01.jpg" },
  { tag:"PR", field:"style", title:"Cinematic Thumbnail Grading", prompt:"Cinematic grading prompt...\nTeal/Orange\nSoft vignette\nClean sharp subject", img:"assets/thumbs/thumb02.jpg" },
  { tag:"AE", field:"style", title:"Trim Path Arabic Reveal", prompt:"Arabic typography reveal animation...\nDuration: 5s\nNo particles\nSoft light beam on strokes", img:"assets/thumbs/thumb01.jpg" },
  { tag:"Ai", field:"ctx",   title:"AI Lighting Prompt", prompt:"AI cinematic lighting, soft rim light, film grain, clean subject separation, premium look", img:"assets/thumbs/thumb02.jpg" },
  // ... كمل 50 بنفس الشكل
];

/* =========================
   ✅ Helpers
========================= */
function normalizeTag(t){
  const v = String(t ?? "").trim();
  if(!v) return "AI";
  const up = v.toUpperCase();
  if(up === "AR" || up === "PR" || up === "AE" || up === "AI" || up === "PROMPT") return "AI";
  return up;
}
function normalizeField(f){
  const v = String(f ?? "").trim().toLowerCase();
  if(["ctx","main","sec","style","char","full"].includes(v)) return v;
  return "ctx";
}

const wrap = document.getElementById("wrap");
const q = document.getElementById("q");
const tag = document.getElementById("tag");
const toast = document.getElementById("toast");

function showToast(msg="تم النسخ ✅"){
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast.t);
  showToast.t = setTimeout(()=>toast.classList.remove("show"), 1200);
}

function copyText(t){
  const text = String(t ?? "");
  navigator.clipboard.writeText(text).then(()=>showToast("تم النسخ ✅")).catch(()=>{
    const ta=document.createElement("textarea");
    ta.value=text; document.body.appendChild(ta);
    ta.select(); document.execCommand("copy");
    ta.remove(); showToast("تم النسخ ✅");
  });
}

function goToEditor(field, value){
  const url = EDITOR_PAGE
    + "?from=prompts"
    + "&field=" + encodeURIComponent(field)
    + "&value=" + encodeURIComponent(value || "");
  location.href = url;
}

/* ✅ Build tags */
(function buildTags(){
  const tags = [...new Set(DATA.map(x=>normalizeTag(x.tag)).filter(Boolean))].sort();
  tags.forEach(t=>{
    const o=document.createElement("option");
    o.value=t; o.textContent=t;
    tag.appendChild(o);
  });
})();

/* =========================
   ✅ Optional group filter from URL
========================= */
const params = new URLSearchParams(location.search);
const group = (params.get("group") || "").toLowerCase();
const groupToField = {
  domain: "ctx",
  clothes: "char",
  text: "style",
  name: "main"
};
const forcedField = groupToField[group] || "";

/* =========================
   ✅ Divider titles كل 15
========================= */
function dividerLabelByChunk(chunkIndex){
  const names = [
    "قسم: تغيير المجال (Context)",
    "قسم: تغيير اللبس والشخصية (Character)",
    "قسم: تغيير ستايل النص (Text Style)",
    "قسم: العناوين (Main/Secondary)"
  ];
  return names[chunkIndex] || ("قسم رقم " + (chunkIndex+1));
}

/* =========================
   ✅ Render
========================= */
function render(){
  const query = (q.value || "").trim().toLowerCase();
  const selected = tag.value;

  const filtered = DATA.filter(item=>{
    const t = normalizeTag(item.tag);
    const okTag = (selected==="all") ? true : t===selected;

    const okGroup = forcedField ? normalizeField(item.field) === forcedField : true;

    const hay = ((item.title||"") + " " + (item.prompt||"")).toLowerCase();
    const okQ = query ? hay.includes(query) : true;

    return okTag && okQ && okGroup;
  });

  wrap.textContent = "";
  const frag = document.createDocumentFragment();

  filtered.forEach((x, i)=>{

    if(i % 15 === 0){
      const chunk = Math.floor(i/15);
      const d = document.createElement("div");
      d.className = "divider";

      const t = document.createElement("div");
      t.className = "dividerTitle";
      t.textContent = dividerLabelByChunk(chunk);

      const h = document.createElement("div");
      h.className = "dividerHint";
      h.textContent = "عدد العناصر: 15";

      d.appendChild(t);
      d.appendChild(h);
      frag.appendChild(d);
    }

    const details = document.createElement("details");
    details.className = "tg";

    const summary = document.createElement("summary");

    const left = document.createElement("div");
    left.className = "tgTitle";

    const badge = document.createElement("span");
    badge.className = "tgBadge";
    badge.textContent = "AI";

    const title = document.createElement("span");
    title.className = "tgText";
    title.textContent = x.title || ("Prompt " + (i+1));

    left.appendChild(badge);
    left.appendChild(title);

    const arrow = document.createElement("div");
    arrow.className = "tgArrow";
    arrow.textContent = "⌄";

    summary.appendChild(left);
    summary.appendChild(arrow);

    const body = document.createElement("div");
    body.className = "tgBody";

    const grid = document.createElement("div");
    grid.className = "tgGrid";

    const col1 = document.createElement("div");

    const promptBox = document.createElement("div");
    promptBox.className = "tgPrompt";
    promptBox.textContent = x.prompt || "";

    const actions = document.createElement("div");
    actions.className = "actions";

    const btnCopy = document.createElement("button");
    btnCopy.className = "btnSmall smallOrange";
    btnCopy.type = "button";
    btnCopy.textContent = "Copy";
    btnCopy.addEventListener("click", ()=>copyText(x.prompt || ""));
    actions.appendChild(btnCopy);

    const btnUse = document.createElement("button");
    btnUse.className = "btnSmall smallTeal";
    btnUse.type = "button";
    btnUse.textContent = "استخدم في المحرّر";
    btnUse.addEventListener("click", ()=>{
      goToEditor(normalizeField(x.field), x.prompt || "");
    });
    actions.appendChild(btnUse);

    if(x.img){
      const a = document.createElement("a");
      a.className = "btnSmall smallTeal";
      a.href = x.img;
      a.target = "_blank";
      a.rel = "noopener";
      a.textContent = "فتح الصورة";
      actions.appendChild(a);
    }

    col1.appendChild(promptBox);
    col1.appendChild(actions);

    const col2 = document.createElement("div");
    col2.className = "tgImg";

    if(x.img){
      const img = document.createElement("img");
      img.loading = "lazy";
      img.decoding = "async";
      img.fetchPriority = "low";
      img.src = x.img;
      img.alt = "";
      col2.appendChild(img);
    }

    grid.appendChild(col1);
    grid.appendChild(col2);

    body.appendChild(grid);

    details.appendChild(summary);
    details.appendChild(body);

    frag.appendChild(details);
  });

  wrap.appendChild(frag);
}

function debounce(fn, wait=180){
  let t;
  return (...args)=>{
    clearTimeout(t);
    t = setTimeout(()=>fn.apply(null,args), wait);
  };
}

q.addEventListener("input", debounce(render, 180));
tag.addEventListener("change", render);
render();
</script>

</body>
</html>